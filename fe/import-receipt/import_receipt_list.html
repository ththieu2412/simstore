<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Import Receipts Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Animation for Fade-In */
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        tr {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Hover Animation */
        tr:hover {
            background-color: #f9fafb;
            transition: background-color 0.3s ease;
        }

        /* Responsive Table Adjustments */
        @media (max-width: 640px) {
            .table-container {
                overflow-x: auto;
            }
        }

        /* Spinner Animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-6">
        <!-- Header -->
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Import Receipts</h1>

        <!-- Loading State -->
        <div id="loading" class="flex justify-center">
            <div class="spinner"></div>
        </div>

        <!-- Error Message -->
        <div id="error" class="hidden text-red-600 text-center mb-4"></div>

        <!-- Table for Detailed View -->
        <div id="tableContainer" class="table-container bg-white shadow-lg rounded-lg p-6 hidden">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Detailed Receipts</h2>
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-gray-200 text-gray-600">
                        <th class="p-3 border-b">ID</th>
                        <th class="p-3 border-b">Created At</th>
                        <th class="p-3 border-b">Note</th>
                        <th class="p-3 border-b">Supplier ID</th>
                        <th class="p-3 border-b">Employee ID</th>
                    </tr>
                </thead>
                <tbody id="receiptsTable"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Function to format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
        }

        // Function to populate table
        function populateTable(receipts) {
            const tableBody = document.getElementById('receiptsTable');
            tableBody.innerHTML = ''; // Clear previous content
            receipts.forEach((receipt, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b';
                row.style.animationDelay = `${index * 0.2}s`;
                row.innerHTML = `
                    <td class="p-3">${receipt.id}</td>
                    <td class="p-3">${formatDate(receipt.created_at)}</td>
                    <td class="p-3">${receipt.note}</td>
                    <td class="p-3">${receipt.supplier}</td>
                    <td class="p-3">${receipt.employee}</td>
                `;
                tableBody.appendChild(row);
            });
            document.getElementById('tableContainer').classList.remove('hidden');
        }

        // Fetch data from API
        async function fetchReceipts() {
            const loading = document.getElementById('loading');
            const errorDiv = document.getElementById('error');

            try {
                const response = await fetch('http://localhost:8000/api/suppliers/import-receipts/');
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();

                // Hide loading spinner
                loading.classList.add('hidden');

                // Populate table with data
                populateTable(data);
            } catch (error) {
                // Hide loading spinner and show error
                loading.classList.add('hidden');
                errorDiv.classList.remove('hidden');
                errorDiv.textContent = `Error fetching data: ${error.message}. Please ensure the API is running at http://localhost:8000.`;
                console.error('Fetch error:', error);
            }
        }

        // Call fetch function on page load
        window.onload = fetchReceipts;
    </script>
</body>
</html>